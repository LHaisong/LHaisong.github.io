---
layout:     post
title:      mysql中的基本概念
subtitle:   存储引擎、锁
date:       2019-05-09
author:     LHaisong
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - 数据库


---



## 数据库和数据库实例

- 数据库是文件的集合，是依据某种数据模型组织起来并存放于二级存储器的数据集合
- 数据库实例是应用程序，是位于操作系统和用户之间的管理程序，用户对数据的操作都是在数据库实例下进行的，应用程序需要通过数据库实例才能与数据库打交道

## 存储引擎

- InnoDB存储引擎：支持事务、行锁设计、支持外键，但是默认的读取不会产生锁。InnoDB通过使用多版本并发控制(MVCC)来获得高并发性，并实现了SQL默认的4种隔离级别，默认状态下是Repeattable，使用next-key locking来避免幻读问题，除此之外还提供了插入缓冲、二次写、自适应哈希索引、预读等高可用功能，表中数据的存储采用了聚集的方式。   

  > 基于磁盘存储，记录按照页的方式管理

- MyISAM存储引擎：不支持事务、表锁设计，支持全文索引，它的缓冲池只缓存索引文件而不缓存数据文件，表由MYD和MYI组成，其中MYD用于存放数据文件，MYI用于存放索引文件

- NDB集群引擎：数据全部存放在内存中，可以将非索引数据存放在磁盘上，因此主键查找很快，并且通过添加数据库节点可以线性的提高数据库性能；需要注意的是NDB引擎的连接操作是在mysql数据库层完成的，并不是在存储引擎层，因此复杂的连接操作会付出巨大的网络开销

- memory存储引擎：将表的数据存放在内存中，如果数据库重启或者崩溃，数据也会消失，合适做临时表，默认使用hash索引

## 索引  

1. 聚集索引：按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的行记录数据，叶子节点也叫数据页，聚集索引能够在B+树叶子节点上直接找到数据。  
2. 非聚集索引：叶子节点不包含表的全部数据，叶子节点中存放着键值，以及一个书签用于告诉InnoDB引擎在哪可以找到这些行数据。 

## 数据库的读写分离  

1. 原理：是让主数据库处理事务性增、改、删操作（INSERT、UPDATE、DELETE），而从数据库处理SELECT查询操作。数据库复制被用来把事务性操作导致的变更同步到集群中的从数据库。  
2. why：数据库的写操作很费时，但是读操作很快，将这两个操作分开提高了查询的效率。  
3. when：数据库不一定要读写分离，如果程序使用数据库较多时，而更新少，查询多的情况下会考虑使用，利用数据库 主从同步 。可以减少数据库压力，提高性能。  

## 主从复制  

- 在实际的生产环境中，对数据库的读和写都在同一个数据库服务器中，是不能满足实际需求的。无论是在安全性、高可用性还是高并发等各个方面都是完全不能满足实际需求的。因此，通过主从复制的方式来同步数据，再通过读写分离来提升数据库的并发负载能力。mysql主从复制是对数据库中的数据、语句做备份。  
- MySQL主从复制是其最重要的功能之一。主从复制是指一台服务器充当主数据库服务器，另一台或多台服务器充当从数据库服务器，主服务器中的数据自动复制到从服务器之中。对于多级复制，数据库服务器即可充当主机，也可充当从机。MySQL主从复制的基础是主服务器对数据库修改记录二进制日志，从服务器通过主服务器的二进制日志自动执行更新。  
- 主从复制的类型：

1. 基于语句的复制：主服务器上面的语句在从服务器再执行一遍  
2. 基于行的复制：把主服务器中改变的内容直接复制给从服务器，而不关心是由什么语句引起的  
3. 混合类型的复制：MySQL默认使用基于语句的复制，当基于语句的复制会引发问题的时候就会使用基于行的复制，MySQL会自动进行选择  
   主从复制的原理：[https://segmentfault.com/a/1190000008942618  ](https://segmentfault.com/a/1190000008942618   "主从复制")  

​    
